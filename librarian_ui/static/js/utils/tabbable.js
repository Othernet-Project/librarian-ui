// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  $.tabbableDefaults = {
    activator: '.o-tab-handle-activator',
    panel: '.o-tab-panel',
    onChange: null
  };
  $.fn.tabable = function(options) {
    var activatePanel, activator, closeActivePanel, elem, onChange, panel;
    if (options == null) {
      options = {};
    }
    options = $.extend({}, $.tabbableDefaults, options);
    activator = options.activator, panel = options.panel, onChange = options.onChange;
    elem = $(this);
    elem.find(activator).each(function() {
      var act;
      act = $(this);
      act.data('panel', elem.find(act.attr('href')));
    });
    closeActivePanel = function() {
      elem.find(panel + '.active').removeClass('active').ariaProperty('expanded', 'false');
      elem.find(activator + '.active').removeClass('active');
    };
    activatePanel = function(targetActivator) {
      var res, targetPanel, url;
      targetActivator = $(targetActivator);
      if (!targetActivator.length) {
        return;
      }
      targetActivator.addClass('active');
      targetPanel = targetActivator.data('panel');
      targetPanel.addClass('active');
      targetPanel.ariaProperty('expanded', 'true');
      if (onChange != null) {
        onChange(targetActivator);
      }
      url = targetPanel.data('url');
      if (!url) {
        return;
      }
      targetPanel.html(templates.spinner);
      res = $.get(url);
      res.done(function(data) {
        return targetPanel.html(data);
      });
      res.fail(function() {
        return targetPanel.html(template.loadFail);
      });
    };
    elem.data('tabbableActivator', activatePanel);
    elem.on('focus', activator, function(e) {
      return elem.trigger('activator-focus');
    });
    elem.on('click', activator, function(e) {
      var act;
      e.preventDefault();
      closeActivePanel();
      act = $(this);
      return activatePanel(act);
    });
    return elem;
  };
  return $.fn.activateTab = function(tabId) {
    var elem, fn;
    elem = $(this);
    fn = elem.data('tabbableActivator');
    if (!fn) {
      return;
    }
    fn(tabId);
    return elem;
  };
})(this, this.jQuery, this.templates);
