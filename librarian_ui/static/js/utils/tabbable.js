// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  return $.fn.tabable = function(options) {
    var activatePanel, activator, closeActivePanel, elem, panel;
    if (options == null) {
      options = {
        activator: '.o-tab-handle-activator',
        panel: '.o-tab-panel'
      };
    }
    activator = options.activator, panel = options.panel;
    elem = $(this);
    elem.find(activator).each(function() {
      var act;
      act = $(this);
      act.data('panel', elem.find(act.attr('href')));
    });
    closeActivePanel = function() {
      elem.find(panel + '.active').removeClass('active').ariaProperty('expanded', 'false');
      elem.find(activator + '.active').removeClass('active');
    };
    activatePanel = function(targetActivator) {
      var res, targetPanel, url;
      targetActivator.addClass('active');
      targetPanel = targetActivator.data('panel');
      targetPanel.addClass('active');
      targetPanel.ariaProperty('expanded', 'true');
      url = targetPanel.data('url');
      if (!url) {
        return;
      }
      targetPanel.html(templates.spinner);
      res = $.get(url);
      res.done(function(data) {
        return targetPanel.html(data);
      });
      res.fail(function() {
        return targetPanel.html(template.loadFail);
      });
    };
    elem.on('focus', activator, function(e) {
      return elem.trigger('activator-focus');
    });
    elem.on('click', activator, function(e) {
      var act;
      e.preventDefault();
      closeActivePanel();
      act = $(this);
      return activatePanel(act);
    });
    return elem;
  };
})(this, this.jQuery, this.templates);
