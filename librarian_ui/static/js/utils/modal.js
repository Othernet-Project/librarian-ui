// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var ESCAPE, body, defaultFailure, defaultSuccess;
  defaultSuccess = templates.modalContent;
  defaultFailure = templates.modalLoadFailure;
  body = $(document.body);
  ESCAPE = 27;
  body.on('click', '.o-modal-overlay', function(e) {
    var elem;
    elem = $(this);
    return elem.remove();
  });
  body.on('click', '.o-modal-close', function(e) {
    var elem;
    elem = $(this);
    return elem.parents('.o-modal-overlay').remove();
  });
  body.on('click', '.o-modal-window', function(e) {
    return e.stopPropagation();
  });
  body.on('keydown', '.o-modal-window', function(e) {
    var elem;
    elem = $(this);
    if (e.which === ESCAPE) {
      return elem.parents('.o-modal-overlay').remove();
    }
  });
  $.modalDialog = function(template) {
    var modal;
    $('.o-modal-overlay').remove();
    modal = $(template);
    modal.appendTo(body);
    return modal;
  };
  return $.modalContent = function(contentUrl, options) {
    var failureTemplate, fullScreen, modal, panel, res, successTemplate;
    if (options == null) {
      options = {};
    }
    if (options.successTemplate == null) {
      options.successTemplate = defaultSuccess;
    }
    if (options.failureTemplate == null) {
      options.failureTemplate = defaultFailure;
    }
    if (options.fullScreen == null) {
      options.fullScreen = false;
    }
    successTemplate = options.successTemplate, failureTemplate = options.failureTemplate, fullScreen = options.fullScreen;
    modal = $.modalDialog(successTemplate);
    window = modal.find('.o-modal-window');
    panel = modal.find('.o-modal-panel');
    if (fullScreen) {
      window.addClass('o-full-screen');
    }
    window.focus();
    res = $.get(contentUrl);
    res.done(function(data) {
      return panel.html(data);
    });
    return res.fail(function() {
      return panel.html(failureTemplate);
    });
  };
})(this, this.jQuery, this.templates);
