// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var ESCAPE, body, defaultFailure, defaultSuccess;
  defaultSuccess = templates.modalContent;
  defaultFailure = templates.modalLoadFailure;
  body = $(document.body);
  ESCAPE = 27;
  body.on('click', '.o-modal-overlay', function(e) {
    var elem;
    elem = $(this);
    return elem.remove();
  });
  body.on('click', '.o-modal-close', function(e) {
    var elem;
    elem = $(this);
    return elem.parents('.o-modal-overlay').remove();
  });
  body.on('click', '.o-modal-window', function(e) {
    return e.stopPropagation();
  });
  body.on('keydown', '.o-modal-window', function(e) {
    var elem;
    elem = $(this);
    if (e.which === ESCAPE) {
      return elem.parents('.o-modal-overlay').remove();
    }
  });
  return $.modalContent = function(contentUrl, options) {
    var failureTemplate, modal, panel, res, successTemplate;
    successTemplate = options.successTemplate, failureTemplate = options.failureTemplate;
    if (successTemplate == null) {
      successTemplate = defaultSuccess;
    }
    if (failureTemplate == null) {
      failureTemplate = defaultFailure;
    }
    $('.o-modal-overlay').remove();
    modal = $(successTemplate);
    modal.appendTo(body);
    window = modal.find('.o-modal-window');
    window.focus();
    panel = modal.find('.o-modal-panel');
    res = $.get(contentUrl);
    res.done(function(data) {
      return panel.html(data);
    });
    return res.fail(function() {
      return panel.html(failureTemplate);
    });
  };
})(this, this.jQuery, this.templates);
